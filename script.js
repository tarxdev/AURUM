import e from"lenis";import*as t from"three";import{RGBELoader as o}from"three/addons/loaders/RGBELoader.js";import{EffectComposer as r}from"three/addons/postprocessing/EffectComposer.js";import{RenderPass as a}from"three/addons/postprocessing/RenderPass.js";import{UnrealBloomPass as n}from"three/addons/postprocessing/UnrealBloomPass.js";import{OutputPass as s}from"three/addons/postprocessing/OutputPass.js";let scrollSpeed=0,frameCount=0,isMobile=window.innerWidth<768,lenis=new e({duration:1.2,easing:e=>Math.min(1,1.001-Math.pow(2,-10*e)),smooth:!0,direction:"vertical"});gsap.registerPlugin(ScrollTrigger),lenis.on("scroll",e=>{ScrollTrigger.update(e),scrollSpeed=e.velocity}),gsap.ticker.add(e=>{lenis.raf(1e3*e)}),gsap.ticker.lagSmoothing(0);let scene=new t.Scene;scene.background=new t.Color(0),scene.fog=new t.Fog(0,15,60);let camera=new t.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,100);camera.position.set(0,0,18);let renderer=new t.WebGLRenderer({canvas:document.querySelector("#webgl"),antialias:!1,alpha:!1,powerPreference:"high-performance"});renderer.setSize(window.innerWidth,window.innerHeight),renderer.setPixelRatio(Math.min(window.devicePixelRatio,isMobile?1:1.5)),renderer.toneMapping=t.ACESFilmicToneMapping,renderer.toneMappingExposure=1,renderer.shadowMap.enabled=!0,renderer.shadowMap.type=t.PCFSoftShadowMap;let composer=new r(renderer),renderPass=new a(scene,camera);composer.addPass(renderPass);let bloomStrength=isMobile?.2:.35,bloomRadius=isMobile?.3:.5,bloomPass=new n(new t.Vector2(window.innerWidth,window.innerHeight),1.5,.4,.85);bloomPass.threshold=.85,bloomPass.strength=bloomStrength,bloomPass.radius=bloomRadius,composer.addPass(bloomPass);let outputPass=new s;composer.addPass(outputPass);let hoverSound=new Audio("Assets/chime.mp3");function playRandomChime(){hoverSound.paused||(hoverSound.currentTime=0),hoverSound.playbackRate=.8+.4*Math.random(),hoverSound.play().catch(()=>{})}hoverSound.volume=.2;let ambientLight=new t.AmbientLight(16777215,.05);scene.add(ambientLight);let spotLight=new t.SpotLight(16772795,800);spotLight.position.set(15,25,15),spotLight.angle=.4,spotLight.penumbra=1,spotLight.castShadow=!0,spotLight.shadow.mapSize.width=1024,spotLight.shadow.mapSize.height=1024,spotLight.shadow.bias=-.0001,scene.add(spotLight);let spotLightTarget=new t.Object3D;spotLightTarget.position.set(0,0,0),scene.add(spotLightTarget),spotLight.target=spotLightTarget;let blueRim=new t.PointLight(17663,100);blueRim.position.set(-10,0,-10),scene.add(blueRim);let goldFill=new t.PointLight(16755200,60);function getSoftGlowTexture(){let e=document.createElement("canvas");e.width=32,e.height=32;let o=e.getContext("2d"),r=o.createRadialGradient(16,16,0,16,16,16);r.addColorStop(0,"rgba(255, 255, 255, 1)"),r.addColorStop(.2,"rgba(255, 255, 255, 0.8)"),r.addColorStop(.5,"rgba(255, 215, 0, 0.2)"),r.addColorStop(1,"rgba(0, 0, 0, 0)"),o.fillStyle=r,o.fillRect(0,0,32,32);let a=new t.CanvasTexture(e);return a}goldFill.position.set(10,-5,5),scene.add(goldFill);let raysVertexShader="varying vec2 vUv; varying vec3 vPosition; void main() { vUv = uv; vPosition = position; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }",raysFragmentShader="uniform float uTime; varying vec2 vUv; float noise(vec2 st) { return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123); } void main() { float angle = vUv.x * 20.0; float ray = sin(angle + uTime * 0.5) * 0.5 + 0.5; float dust = noise(vUv * 10.0 + vec2(0.0, -uTime * 0.8)); float fade = smoothstep(0.0, 0.3, vUv.y) * (1.0 - smoothstep(0.8, 1.0, vUv.y)); gl_FragColor = vec4(vec3(1.0, 0.9, 0.7), (ray * 0.3 + dust * 0.2) * fade * 0.4); }",godRaysMaterial=new t.ShaderMaterial({vertexShader:"varying vec2 vUv; varying vec3 vPosition; void main() { vUv = uv; vPosition = position; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }",fragmentShader:"uniform float uTime; varying vec2 vUv; float noise(vec2 st) { return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123); } void main() { float angle = vUv.x * 20.0; float ray = sin(angle + uTime * 0.5) * 0.5 + 0.5; float dust = noise(vUv * 10.0 + vec2(0.0, -uTime * 0.8)); float fade = smoothstep(0.0, 0.3, vUv.y) * (1.0 - smoothstep(0.8, 1.0, vUv.y)); gl_FragColor = vec4(vec3(1.0, 0.9, 0.7), (ray * 0.3 + dust * 0.2) * fade * 0.4); }",uniforms:{uTime:{value:0}},transparent:!0,depthWrite:!1,blending:t.AdditiveBlending,side:t.DoubleSide}),causticsVertexShader="varying vec2 vUv; void main() { vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }",causticsFragmentShader="uniform float uTime; varying vec2 vUv; float caustic(vec2 uv) { vec2 p = mod(uv * 6.28, 6.28) - 250.0; float c = 1.0; for (int n = 0; n < 5; n++) { float t = uTime * (1.0 - (3.5 / float(n+1))); p += vec2(cos(t - p.x) + sin(t + p.y), sin(t - p.y) + cos(t + p.x)); c += 1.0/length(vec2(p.x / (sin(p.x+t)/0.005),p.y / (cos(p.y+t)/0.005))); } return pow(abs(1.17 - pow(c/5.0, 1.4)), 8.0); } void main() { float val = caustic(vUv * vec2(8.0, 4.0)); float mask = 1.0 - smoothstep(0.1, 0.45, distance(vec2(vUv.x * 0.3, vUv.y), vec2(0.15, 0.5))); gl_FragColor = vec4(vec3(0.8, 0.6, 0.2) * val, val * mask * 0.6); }",causticsMaterial=new t.ShaderMaterial({vertexShader:"varying vec2 vUv; void main() { vUv = uv; gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }",fragmentShader:"uniform float uTime; varying vec2 vUv; float caustic(vec2 uv) { vec2 p = mod(uv * 6.28, 6.28) - 250.0; float c = 1.0; for (int n = 0; n < 5; n++) { float t = uTime * (1.0 - (3.5 / float(n+1))); p += vec2(cos(t - p.x) + sin(t + p.y), sin(t - p.y) + cos(t + p.x)); c += 1.0/length(vec2(p.x / (sin(p.x+t)/0.005),p.y / (cos(p.y+t)/0.005))); } return pow(abs(1.17 - pow(c/5.0, 1.4)), 8.0); } void main() { float val = caustic(vUv * vec2(8.0, 4.0)); float mask = 1.0 - smoothstep(0.1, 0.45, distance(vec2(vUv.x * 0.3, vUv.y), vec2(0.15, 0.5))); gl_FragColor = vec4(vec3(0.8, 0.6, 0.2) * val, val * mask * 0.6); }",uniforms:{uTime:{value:0}},transparent:!0,depthWrite:!1,blending:t.AdditiveBlending}),haloVertexShader="varying vec3 vNormal; void main() { vNormal = normalize(normalMatrix * normal); gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }",haloFragmentShader="varying vec3 vNormal; void main() { float intensity = pow(0.6 - dot(vNormal, vec3(0,0,1)), 4.0); gl_FragColor = vec4(1.0, 0.7, 0.2, 1.0) * intensity * 1.5; }",haloMaterial=new t.ShaderMaterial({vertexShader:"varying vec3 vNormal; void main() { vNormal = normalize(normalMatrix * normal); gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }",fragmentShader:"varying vec3 vNormal; void main() { float intensity = pow(0.6 - dot(vNormal, vec3(0,0,1)), 4.0); gl_FragColor = vec4(1.0, 0.7, 0.2, 1.0) * intensity * 1.5; }",blending:t.AdditiveBlending,side:t.FrontSide,transparent:!0,depthWrite:!1}),liquidVertexShader="varying vec2 vUv; varying vec3 vPosition; varying vec3 vNormal; void main() { vUv = uv; vPosition = position; vNormal = normalize(normalMatrix * normal); gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }",liquidFragmentShader="uniform float uTime; uniform vec3 uColorA; uniform vec3 uColorB; varying vec2 vUv; varying vec3 vPosition; varying vec3 vNormal; float noise(vec2 st) { return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123); } void main() { float n = noise(vUv * 4.0 + uTime * 0.2); float fresnel = pow(1.0 - dot(normalize(cameraPosition - vPosition), vNormal), 3.0); vec3 color = mix(uColorA, uColorB, n) + vec3(1.0, 0.9, 0.5) * fresnel * 1.5; gl_FragColor = vec4(color, 1.0); }",customGoldMaterial=new t.ShaderMaterial({vertexShader:"varying vec2 vUv; varying vec3 vPosition; varying vec3 vNormal; void main() { vUv = uv; vPosition = position; vNormal = normalize(normalMatrix * normal); gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }",fragmentShader:"uniform float uTime; uniform vec3 uColorA; uniform vec3 uColorB; varying vec2 vUv; varying vec3 vPosition; varying vec3 vNormal; float noise(vec2 st) { return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123); } void main() { float n = noise(vUv * 4.0 + uTime * 0.2); float fresnel = pow(1.0 - dot(normalize(cameraPosition - vPosition), vNormal), 3.0); vec3 color = mix(uColorA, uColorB, n) + vec3(1.0, 0.9, 0.5) * fresnel * 1.5; gl_FragColor = vec4(color, 1.0); }",uniforms:{uTime:{value:0},uColorA:{value:new t.Color(11168825)},uColorB:{value:new t.Color(16766720)}}}),dustVertexShader="uniform float uTime; uniform float uSize; varying vec3 vWorldPos; void main() { vec4 worldPosition = modelMatrix * vec4(position, 1.0); vWorldPos = worldPosition.xyz; vec4 mvPosition = viewMatrix * worldPosition; gl_Position = projectionMatrix * mvPosition; gl_PointSize = uSize * (120.0 / -mvPosition.z); }",dustFragmentShader="uniform vec3 uLightPos; uniform vec3 uLightTarget; uniform float uTime; varying vec3 vWorldPos; void main() { vec2 coord = gl_PointCoord - vec2(0.5); float dist = length(coord); if(dist > 0.5) discard; float circle = 1.0 - smoothstep(0.3, 0.5, dist); vec3 lightDir = normalize(uLightTarget - uLightPos); vec3 toPart = normalize(vWorldPos - uLightPos); float angle = dot(lightDir, toPart); float inLight = smoothstep(0.92, 0.98, angle); float twinkle = sin(uTime * 5.0 + vWorldPos.x * 10.0) * 0.5 + 0.5; vec3 baseColor = vec3(0.7, 0.5, 0.2); vec3 litColor = vec3(1.0, 1.0, 0.9); vec3 finalColor = mix(baseColor, litColor, inLight); float alpha = mix(0.2, 0.8 + (twinkle * 0.2), inLight); gl_FragColor = vec4(finalColor, alpha * circle); }",dustMaterial=new t.ShaderMaterial({vertexShader:"uniform float uTime; uniform float uSize; varying vec3 vWorldPos; void main() { vec4 worldPosition = modelMatrix * vec4(position, 1.0); vWorldPos = worldPosition.xyz; vec4 mvPosition = viewMatrix * worldPosition; gl_Position = projectionMatrix * mvPosition; gl_PointSize = uSize * (120.0 / -mvPosition.z); }",fragmentShader:"uniform vec3 uLightPos; uniform vec3 uLightTarget; uniform float uTime; varying vec3 vWorldPos; void main() { vec2 coord = gl_PointCoord - vec2(0.5); float dist = length(coord); if(dist > 0.5) discard; float circle = 1.0 - smoothstep(0.3, 0.5, dist); vec3 lightDir = normalize(uLightTarget - uLightPos); vec3 toPart = normalize(vWorldPos - uLightPos); float angle = dot(lightDir, toPart); float inLight = smoothstep(0.92, 0.98, angle); float twinkle = sin(uTime * 5.0 + vWorldPos.x * 10.0) * 0.5 + 0.5; vec3 baseColor = vec3(0.7, 0.5, 0.2); vec3 litColor = vec3(1.0, 1.0, 0.9); vec3 finalColor = mix(baseColor, litColor, inLight); float alpha = mix(0.2, 0.8 + (twinkle * 0.2), inLight); gl_FragColor = vec4(finalColor, alpha * circle); }",uniforms:{uTime:{value:0},uSize:{value:.18},uLightPos:{value:new t.Vector3},uLightTarget:{value:new t.Vector3}},transparent:!0,depthWrite:!1,blending:t.AdditiveBlending}),envMapLoader=new o,envMap,goldPolished=new t.MeshPhysicalMaterial({color:16766720,metalness:1,roughness:.1,clearcoat:1,envMapIntensity:3}),goldBrushed=new t.MeshPhysicalMaterial({color:11175936,metalness:1,roughness:.65,envMapIntensity:1.5}),crystalMat=new t.MeshPhysicalMaterial({color:16777215,metalness:.1,roughness:0,transmission:1,thickness:2.5,ior:1.8,envMapIntensity:4}),lightCoreMat=new t.MeshBasicMaterial({color:16755200,transparent:!0,opacity:1}),mainGroup=new t.Group;scene.add(mainGroup);let raysMesh=new t.Mesh(new t.CylinderGeometry(5,12,40,32,1,!0),godRaysMaterial);raysMesh.position.set(15,25,15),raysMesh.rotation.x=Math.PI/2,scene.add(raysMesh);let floorMesh=new t.Mesh(new t.PlaneGeometry(100,40),causticsMaterial);function createLuxuryBell(e,o){let r=new t.Group;r.position.copy(e),r.scale.set(o,o,o);let a=new t.Mesh(new t.SphereGeometry(1.2),new t.MeshBasicMaterial({visible:!1}));r.add(a),r.userData.hitbox=a;let n=[];for(let s=0;s<10;s++)n.push(new t.Vector2(.5*Math.sin(.2*s)+.3,(s-5)*.2));n.push(new t.Vector2(1,-1.2)),n.push(new t.Vector2(1.1,-1.3)),n.push(new t.Vector2(.9,-1.3));let l=new t.Mesh(new t.LatheGeometry(n,64),goldBrushed);r.add(l);let $=new t.Mesh(new t.TorusKnotGeometry(.25,.05,64,8,2,3),goldPolished);$.position.y=1,r.add($);let c=new t.Mesh(new t.ConeGeometry(.2,.5,16).translate(0,-.25,0),crystalMat);return c.add(new t.Mesh(new t.SphereGeometry(.2),crystalMat)),c.children[0].position.y=.25,c.position.y=-.8,r.add(c),r.userData.rotateSpeed=.01*Math.random()+.005,r.userData.initialY=e.y,r.userData.clapper=c,r.userData.type="bell",r}function createCrystalStar(e,o){let r=new t.Group;r.position.copy(e),r.scale.set(o,o,o);let a=new t.Mesh(new t.SphereGeometry(1.3),new t.MeshBasicMaterial({visible:!1}));r.add(a),r.userData.hitbox=a;let n=new t.Mesh(new t.IcosahedronGeometry(.7,1),crystalMat);r.add(n);let s=new t.Mesh(new t.IcosahedronGeometry(.8,1),goldPolished.clone());s.material.wireframe=!0,r.add(s);let l=new t.ConeGeometry(.1,2.2,8),$=new t.IcosahedronGeometry(1,0).attributes.position.array;for(let c=0;c<$.length;c+=3){let d=new t.Vector3($[c],$[c+1],$[c+2]).normalize(),u=c%2==0?crystalMat:goldPolished,m=new t.Mesh(l,u);m.quaternion.setFromUnitVectors(new t.Vector3(0,1,0),d),m.position.copy(d.multiplyScalar(.7)),r.add(m)}return n.add(new t.Mesh(new t.SphereGeometry(.3),lightCoreMat)),r.userData.rotateSpeed=.015*Math.random()+.005,r.userData.initialY=e.y,r.userData.type="star",r}function createFacetedBauble(e,o,r){let a=new t.Group;a.position.copy(e),a.scale.set(o,o,o);let n=new t.Mesh(new t.SphereGeometry(1.2),new t.MeshBasicMaterial({visible:!1}));a.add(n),a.userData.hitbox=n;let s=new t.Mesh(new t.IcosahedronGeometry(.75,8),r);s.castShadow=!0,s.receiveShadow=!0,a.add(s);let l=new t.Mesh(new t.IcosahedronGeometry(.95,2),goldPolished.clone());l.material.wireframe=!0,a.add(l);let $=new t.TorusGeometry(1.1,.015,16,64),c=new t.Mesh($,goldPolished);c.rotation.x=Math.PI/2,a.add(c);let d=new t.Mesh($,goldPolished);d.rotation.y=Math.PI/2.5,a.add(d);let u=new t.Mesh(new t.CylinderGeometry(.12,.2,.25,16),goldPolished);u.position.y=.85,a.add(u);let m=new t.Mesh(new t.TorusGeometry(.08,.02,8,16),goldPolished);return m.position.y=1,m.rotation.y=Math.PI/2,a.add(m),a.userData.rotateSpeed=.005*Math.random()+.002,a.userData.initialY=e.y,a.userData.rings=[l,c,d],a.userData.type="bauble",a}floorMesh.rotation.x=-Math.PI/2,floorMesh.position.y=-10,scene.add(floorMesh),envMapLoader.load("Assets/env.hdr",function(e){(envMap=e).mapping=t.EquirectangularReflectionMapping,scene.environment=envMap,scene.environmentRotation=new t.Euler(0,0,0);let o=createFacetedBauble(new t.Vector3(0,-2.5,-2),3.2,customGoldMaterial);o.add(new t.Mesh(new t.IcosahedronGeometry(.85,4),haloMaterial)),mainGroup.add(o);let r=createCrystalStar(new t.Vector3(-6,5,-4),1.7);mainGroup.add(r);let a=createLuxuryBell(new t.Vector3(8,-2,-2),1.5);mainGroup.add(a);let n=createFacetedBauble(new t.Vector3(-5,-5,2),1.4,goldBrushed);mainGroup.add(n);let s=createCrystalStar(new t.Vector3(-6,0,-1),1.1);mainGroup.add(s);let l=createLuxuryBell(new t.Vector3(6,8,-2),1.2);mainGroup.add(l);let $=createFacetedBauble(new t.Vector3(3,-4,-5),1.8,crystalMat);mainGroup.add($),mainGroup.userData.themedObjects=[o,r,a,n,s,l,$],mainGroup.userData.hero=o,document.querySelector(".preloader .line").style.width="100%",setTimeout(()=>{document.querySelector(".preloader").style.transform="translateY(-100%)",setTimeout(()=>initScrollAnimations(),500)},1e3)});let pGeo=new t.BufferGeometry,pCount=isMobile?800:3e3,pPos=new Float32Array(3*pCount),pOriginalPos=new Float32Array(3*pCount),pVel=[];for(let i=0;i<pCount;i++){let l=(Math.random()-.5)*70,$=(Math.random()-.5)*70,c=(Math.random()-.5)*50;pPos[3*i]=l,pPos[3*i+1]=$,pPos[3*i+2]=c,pOriginalPos[3*i]=l,pOriginalPos[3*i+1]=$,pOriginalPos[3*i+2]=c,pVel.push({y:.02*Math.random()+.005,x:(Math.random()-.5)*.01,z:(Math.random()-.5)*.01})}pGeo.setAttribute("position",new t.BufferAttribute(pPos,3));let particles=new t.Points(pGeo,dustMaterial);scene.add(particles);let trailCount=isMobile?30:60,trailGeo=new t.BufferGeometry,trailPos=new Float32Array(3*trailCount),trailSizes=new Float32Array(trailCount);trailGeo.setAttribute("position",new t.BufferAttribute(trailPos,3)),trailGeo.setAttribute("size",new t.BufferAttribute(trailSizes,1));let trailMat=new t.PointsMaterial({color:16772795,map:getSoftGlowTexture(),transparent:!0,opacity:.5,sizeAttenuation:!0,blending:t.AdditiveBlending,depthWrite:!1}),trail=new t.Points(trailGeo,trailMat);scene.add(trail);let trailData=[];for(let i=0;i<trailCount;i++)trailData.push({vx:(Math.random()-.5)*.01,vy:(Math.random()-.5)*.01,vz:(Math.random()-.5)*.01,life:0,maxLife:.5+.5*Math.random()}),trailPos[3*i]=9999;let raycaster=new t.Raycaster,mouseVector=new t.Vector2,mouseX=0,mouseY=0,targetMouseX=0,targetMouseY=0,currentIntersects=[];function animate(){requestAnimationFrame(animate),frameCount++;let e=.001*performance.now();customGoldMaterial.uniforms&&(customGoldMaterial.uniforms.uTime.value=e),godRaysMaterial.uniforms&&(godRaysMaterial.uniforms.uTime.value=e),causticsMaterial.uniforms&&(causticsMaterial.uniforms.uTime.value=e),dustMaterial.uniforms&&(dustMaterial.uniforms.uTime.value=e,dustMaterial.uniforms.uLightPos.value.copy(spotLight.position),dustMaterial.uniforms.uLightTarget.value.copy(spotLightTarget.position),dustMaterial.uniforms.uSize.value=.18+Math.min(.002*Math.abs(scrollSpeed),.05)),scene.environment&&(scene.environmentRotation.y=.05*e+1.5*mouseX,scene.environmentRotation.x=.1*Math.sin(.2*e)-.8*mouseY,scene.environmentRotation.z=.05*Math.cos(.15*e));let o=.5*Math.sin(.5*e)+.5*Math.cos(.2*e),r=.5*Math.cos(.3*e)+.5*Math.sin(.15*e);camera.fov+=(45+1.5*Math.sin(.2*e)-camera.fov)*.02,camera.updateProjectionMatrix(),camera.position.x+=(.5*mouseX+o-camera.position.x)*.05,camera.position.y+=(.3*mouseY+r-camera.position.y)*.05,camera.lookAt(2*o,1*r,0),camera.rotation.z=.02*Math.sin(.1*e),mouseX+=(targetMouseX-mouseX)*.05,mouseY+=(targetMouseY-mouseY)*.05,spotLight.position.x=15+12*mouseX,spotLight.position.y=25+-(8*mouseY),spotLightTarget.position.x=8*mouseX,spotLightTarget.position.y=-(8*mouseY),raysMesh.position.copy(spotLight.position),raysMesh.lookAt(spotLightTarget.position),raysMesh.rotateX(Math.PI/2),mainGroup.rotation.y+=.002,mainGroup.rotation.x+=(-(.15*mouseY)-mainGroup.rotation.x)*.05,mainGroup.rotation.y+=(.15*mouseX-.05*mainGroup.rotation.y)*.05;let a=particles.geometry.attributes.position.array,n=25*mouseX,s=15*mouseY,l=1+2*Math.abs(scrollSpeed);for(let $=0;$<pCount;$++){let c=3*$,d=3*$+1,u=3*$+2;a[d]-=pVel[$].y,a[d]+=.005*scrollSpeed,a[c]+=.005*Math.sin(e*l+.05*a[d]);let m=n-a[c],v=s-a[d],p=m*m+v*v;if(p<16){let g=Math.sqrt(p),h=(4-g)/4,_=Math.atan2(v,m);a[c]-=Math.cos(_)*h*.5,a[d]-=Math.sin(_)*h*.5}else a[c]+=(pOriginalPos[c]-a[c])*.02,a[u]+=(pOriginalPos[u]-a[u])*.02;a[d]<-35&&(a[d]=35,a[c]=(Math.random()-.5)*70,a[u]=(Math.random()-.5)*50,pOriginalPos[c]=a[c],pOriginalPos[u]=a[u]),a[d]>35&&(a[d]=-35)}particles.geometry.attributes.position.needsUpdate=!0,raycaster.setFromCamera(mouseVector,camera);let f=new t.Vector3;raycaster.ray.at(15,f);let y=0;for(let w=0;w<trailCount;w++)if(trailData[w].life<=0&&y<2&&(trailData[w].life=trailData[w].maxLife,trailPos[3*w]=f.x+(Math.random()-.5)*.05,trailPos[3*w+1]=f.y+(Math.random()-.5)*.05,trailPos[3*w+2]=f.z+(Math.random()-.5)*.05,y++),trailData[w].life>0){trailData[w].life-=.02,trailPos[3*w]+=trailData[w].vx,trailPos[3*w+1]+=trailData[w].vy,trailPos[3*w+2]+=trailData[w].vz;let M=trailData[w].life/trailData[w].maxLife;trailSizes[w]=.15*Math.sin(M*Math.PI)}else trailSizes[w]=0;if(trail.geometry.attributes.position.needsUpdate=!0,trail.geometry.attributes.size.needsUpdate=!0,frameCount%5==0&&(raycaster.setFromCamera(mouseVector,camera),currentIntersects=raycaster.intersectObjects(mainGroup.children,!0)),mainGroup.userData.themedObjects){let P=mainGroup.userData.hero;P.rotation.y+=.005,P.position.y=P.userData.initialY+.5*Math.sin(.8*e),P.userData.rings&&(P.userData.rings[0].rotation.y-=.01,P.userData.rings[0].rotation.z+=.005,P.userData.rings[1].rotation.x+=.01,P.userData.rings[2].rotation.y-=.015),mainGroup.userData.themedObjects.forEach(o=>{let r=!1;if(o.userData.hitbox)for(let a of currentIntersects)a.object===o.userData.hitbox&&(r=!0);r?o.userData.wasHovered||(playRandomChime(),o.userData.wasHovered=!0):o.userData.wasHovered=!1;let n=r?1.15:1;if(o.scale.lerp(new t.Vector3(n,n,n),.1),o!==P){if("bell"===o.userData.type){let s=r?.3*Math.sin(15*e):.1*Math.sin(3*e);o.rotation.z+=(s-o.rotation.z)*.1,o.userData.clapper.rotation.z=1.5*s}else"star"===o.userData.type?(o.rotation.y+=o.userData.rotateSpeed*(r?4:1),o.rotation.z+=r?.05:0):o.rotation.y+=o.userData.rotateSpeed/2*(r?4:1)}})}composer.render()}function splitTextIntoSpans(e){document.querySelectorAll(e).forEach(e=>{let t=e.innerText;e.innerHTML="",t.split("").forEach(t=>{let o=document.createElement("span");o.innerHTML=" "===t?"&nbsp;":t,e.appendChild(o)})})}function initScrollAnimations(){gsap.to(".scroll-progress",{width:"100%",ease:"none",scrollTrigger:{trigger:"body",start:"top top",end:"bottom bottom",scrub:0}}),gsap.to(camera.position,{z:8,ease:"none",scrollTrigger:{trigger:".hero",start:"top top",end:"bottom top",scrub:1}});let e=gsap.timeline({defaults:{ease:"power4.out"}}),t=["#t1 span","#t2 span","#t3 span","#t4 span","#t5 span"];document.querySelector(t[0])&&e.fromTo(t,{y:"110%"},{y:"0%",duration:1.8,stagger:.1},.1),mainGroup.userData.hero&&gsap.from(mainGroup.scale,{duration:2.5,x:0,y:0,z:0,ease:"elastic.out(1, 0.5)"}),gsap.to(mainGroup.rotation,{y:2*Math.PI,scrollTrigger:{trigger:".hero",start:"top top",end:"bottom top",scrub:1}}),splitTextIntoSpans(".editorial-section h2"),document.querySelectorAll(".content-row").forEach(e=>{let t=e.querySelectorAll("h2 span"),o=e.querySelector("p"),r=gsap.timeline({scrollTrigger:{trigger:e,start:"top 75%",toggleActions:"play none none reverse"}});r.fromTo(t,{y:100,rotationX:-90,opacity:0,filter:"blur(10px)"},{y:0,rotationX:0,opacity:1,filter:"blur(0px)",stagger:.03,duration:1.2,ease:"power4.out"}).to(o,{y:0,opacity:1,filter:"blur(0px)",duration:1.5,ease:"power2.out"},"-=0.8")}),document.querySelectorAll(".quote-container").forEach(e=>{gsap.fromTo(e,{opacity:0,scale:.9,y:50},{opacity:1,scale:1,y:0,duration:2,ease:"power2.out",scrollTrigger:{trigger:e,start:"top 75%",end:"bottom 20%",toggleActions:"play none none reverse"}})}),document.querySelectorAll(".finale-img-container").forEach(e=>{let t=e.querySelector("img"),o=e.querySelector(".img-label"),r=gsap.timeline({scrollTrigger:{trigger:e,start:"top 85%",end:"bottom 20%",toggleActions:"play none none reverse"}});r.fromTo(e,{clipPath:"inset(0 0 100% 0)"},{clipPath:"inset(0 0 0% 0)",duration:1.5,ease:"expo.out"}).fromTo(t,{scale:1.4},{scale:1,duration:2,ease:"power2.out"},"<").fromTo(o,{y:30,autoAlpha:0},{y:0,autoAlpha:1,duration:1,ease:"back.out(1.7)"},"-=1.5"),gsap.to(t,{y:"20%",ease:"none",scrollTrigger:{trigger:e,start:"top bottom",end:"bottom top",scrub:!0}})})}window.addEventListener("mousemove",e=>{targetMouseX=(e.clientX/window.innerWidth-.5)*2,targetMouseY=(e.clientY/window.innerHeight-.5)*2,mouseVector.x=e.clientX/window.innerWidth*2-1,mouseVector.y=-(2*(e.clientY/window.innerHeight))+1}),isMobile&&window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",e=>{let t=(e.gamma||0)/45,o=(e.beta||0)/45;targetMouseX=Math.max(-1,Math.min(1,t)),targetMouseY=Math.max(-1,Math.min(1,o))},!0),animate(),window.addEventListener("resize",()=>{camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight),composer.setSize(window.innerWidth,window.innerHeight),bloomPass.resolution.set(window.innerWidth,window.innerHeight)});let sb=document.getElementById("sound-btn"),am=document.getElementById("ambient-music"),ip=!1;sb&&am&&(am.volume=.5,sb.addEventListener("click",()=>{ip?gsap.to(am,{volume:0,duration:1,onComplete(){am.pause(),ip=!1,sb.classList.remove("sound-active"),sb.querySelector(".sound-text").innerText="SOM OFF"}}):am.play().then(()=>{ip=!0,sb.classList.add("sound-active"),sb.querySelector(".sound-text").innerText="SOM ON",gsap.fromTo(am,{volume:0},{volume:.5,duration:2})}).catch(e=>console.error("Erro ao tocar \xe1udio:",e))}));let cr=document.querySelector(".custom-cursor"),fl=document.querySelector(".cursor-follower");cr&&fl&&(window.addEventListener("mousemove",e=>{gsap.to(cr,{x:e.clientX,y:e.clientY,duration:0}),gsap.to(fl,{x:e.clientX,y:e.clientY,duration:.5,ease:"power2.out"})}),document.querySelectorAll("a, button, .finale-img-container, .sound-toggle").forEach(e=>{e.addEventListener("mouseenter",()=>{document.body.classList.add("cursor-hover")}),e.addEventListener("mouseleave",()=>{document.body.classList.remove("cursor-hover")})})),window.addEventListener("touchstart",e=>{let t=e.touches[0];mouseVector.x=t.clientX/window.innerWidth*2-1,mouseVector.y=-(2*(t.clientY/window.innerHeight))+1,raycaster.setFromCamera(mouseVector,camera);let o=raycaster.intersectObjects(mainGroup.children,!0);if(o.length>0){let r=o[0].object;for(;r.parent&&r.parent!==mainGroup;)r=r.parent;r.userData&&r.userData.type&&(playRandomChime(),gsap.to(r.rotation,{y:r.rotation.y+2,duration:1.5,ease:"elastic.out(1, 0.3)"}),gsap.fromTo(r.scale,{x:1.3,y:1.3,z:1.3},{x:1,y:1,z:1,duration:1,ease:"elastic.out(1, 0.5)"}))}},{passive:!1});